jQuery(document).on('gform_post_render',gravityformsqualpay);function gravityformsqualpay(a,b,c){if((window.gf_cc_rules||(window.gf_cc_rules=gfp_qualpay_frontend_strings.credit_card_rules),b===parseInt(gfp_qualpay_frontend_strings.formId))&&!(gfp_qualpay_frontend_strings.hasPages&&c!==gfp_qualpay_frontend_strings.pageCount))if(gformQualpayIsPostback(b)&&gformQualpayHasError(b)){qpEmbeddedForm.unloadFrame();var d={action:'gaddon_qualpay_transient_key',gaddon_qualpay_transient_key:gfp_qualpay_frontend_strings.transient_key_nonce,form_id:b};jQuery.post(gfp_qualpay_frontend_strings.ajaxurl,d).done(function(e){!0===e.success&&(gfp_qualpay_frontend_strings.transientKey=e.data,gravityformsqualpay_load_frame())})}else gravityformsqualpay_load_frame()}function gravityformsqualpay_load_frame(){qpEmbeddedForm.loadFrame(gfp_qualpay_frontend_strings.merchant_id,{formId:gfp_qualpay_frontend_strings.form_element_id,mode:gfp_qualpay_frontend_strings.mode,transientKey:gfp_qualpay_frontend_strings.transientKey,tokenize:!0,onSuccess:gravityformsqualpay_success,onError:gravityformsqualpay_error})}function gravityformsqualpay_success(a){var b=a.card_id,c=a.card_number,d=gfp_qualpay_frontend_strings.formId,e=jQuery('#gform_'+d),f=gfp_qualpay_frontend_strings.creditcard_field_id;e.find(gfp_qualpay_frontend_strings.responseField).val(b),e.find('#input_'+d+'_'+f+'_1').val(c),e.find('#input_'+d+'_'+f+'_4').val(gformFindCardType(c)),e.submit()}function gravityformsqualpay_error(a){var b=jQuery('#gform_'+gfp_qualpay_frontend_strings.formId);if(a.detail){var c='';for(let d in a.detail)c+=a.detail[d];b.find(gfp_qualpay_frontend_strings.errorField).val(c)}b.submit()}function gformQualpayIsPostback(a){var b=!1,c=jQuery('#gform_ajax_frame_'+a).contents().find('*').html();return'undefined'!=typeof c&&(b=0<c.indexOf('GF_AJAX_POSTBACK')),b}function gformQualpayHasError(a){return jQuery('#gform_confirmation_wrapper_'+a).hasClass('gform_validation_error')||jQuery('#gform_ajax_frame_'+a).contents().find('#gform_wrapper_'+a).hasClass('gform_validation_error')}